<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pickleball Stats</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* iOS Safe Area & Touch Tweaks */
        body { -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
        .btn-touch { transition: transform 0.05s; }
        .btn-touch:active { transform: scale(0.95); }
        input:focus { outline: none; border-color: #3b82f6; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-900 text-white h-screen flex flex-col font-sans overflow-hidden">

    <header class="bg-slate-800 p-3 flex justify-between items-center shadow-lg shrink-0 z-20">
        <div class="flex items-center space-x-2">
            <span class="text-xl">ðŸ¥’</span>
            <h1 class="font-bold text-lg tracking-wider">PB TRACKER</h1>
        </div>
        <div class="flex space-x-3">
            <button onclick="app.toggleHistory()" class="text-slate-400 font-medium text-sm">HISTORY</button>
            <button onclick="app.resetMatchConfirm()" class="text-red-400 font-medium text-sm">NEW MATCH</button>
        </div>
    </header>

    <div id="setup-screen" class="absolute inset-0 bg-slate-900 z-50 flex flex-col p-6 overflow-y-auto hidden">
        <h2 class="text-2xl font-bold mb-6 text-center text-blue-400">Match Setup</h2>
        
        <div class="space-y-6">
            <div class="bg-slate-800 p-4 rounded-xl border border-blue-900/50">
                <h3 class="text-blue-400 font-bold mb-3">TEAM A</h3>
                <input type="text" id="p1-name" placeholder="Player 1 Name" class="w-full bg-slate-700 p-3 rounded mb-3 text-white">
                <input type="text" id="p2-name" placeholder="Player 2 Name" class="w-full bg-slate-700 p-3 rounded text-white">
            </div>

            <div class="bg-slate-800 p-4 rounded-xl border border-orange-900/50">
                <h3 class="text-orange-400 font-bold mb-3">TEAM B</h3>
                <input type="text" id="p3-name" placeholder="Player 3 Name" class="w-full bg-slate-700 p-3 rounded mb-3 text-white">
                <input type="text" id="p4-name" placeholder="Player 4 Name" class="w-full bg-slate-700 p-3 rounded text-white">
            </div>

            <button onclick="app.startMatch()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg text-lg">
                START MATCH
            </button>
            
            <div class="mt-8 border-t border-slate-700 pt-4">
                <h3 class="text-slate-400 mb-2">Saved Matches</h3>
                <div id="history-list-setup" class="space-y-2">
                    </div>
            </div>
        </div>
    </div>

    <main id="main-interface" class="flex-1 flex flex-col overflow-hidden hidden">
        
        <div class="bg-slate-800 p-2 grid grid-cols-3 gap-2 shrink-0 border-b border-slate-700">
            <select id="game-selector" onchange="app.switchGame(this.value)" class="bg-slate-700 text-white text-sm rounded px-2 py-2">
                <option value="1">Game 1</option>
                <option value="2">Game 2</option>
                <option value="3">Game 3</option>
            </select>
            <button onclick="app.undoLast()" class="bg-slate-700 text-slate-300 rounded px-2 py-2 text-sm font-bold">âŽŒ UNDO</button>
            <button onclick="app.showStats()" class="bg-blue-600 text-white rounded px-2 py-2 text-sm font-bold">ðŸ“Š STATS</button>
        </div>

        <div class="flex text-center font-bold text-lg shrink-0">
            <button onclick="app.switchTab('A')" id="tab-btn-A" class="flex-1 py-3 bg-slate-700 border-b-4 border-blue-500 text-blue-100">TEAM A</button>
            <button onclick="app.switchTab('B')" id="tab-btn-B" class="flex-1 py-3 bg-slate-800 border-b-4 border-transparent text-slate-500">TEAM B</button>
        </div>

        <div id="input-area" class="flex-1 overflow-y-auto no-scrollbar relative bg-slate-900">
            
            <div id="view-A" class="p-2 space-y-4 pb-10">
                <div class="bg-slate-800 rounded-lg p-3 border border-slate-700">
                    <h3 class="text-blue-300 font-bold text-lg mb-2" id="lbl-p1">Player 1</h3>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <div class="bg-red-900/20 p-2 rounded">
                            <div class="text-xs text-red-400 font-bold mb-1 uppercase tracking-wide text-center">Errors</div>
                            <div class="grid grid-cols-3 gap-1">
                                <button onclick="app.addStat('p1', 'err_serve')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">SRV</button>
                                <button onclick="app.addStat('p1', 'err_return')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">RET</button>
                                <button onclick="app.addStat('p1', 'err_net')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">NET</button>
                                <button onclick="app.addStat('p1', 'err_wide')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">WIDE</button>
                                <button onclick="app.addStat('p1', 'err_long')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">LONG</button>
                                <button onclick="app.addStat('p1', 'err_high')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">HIGH</button>
                            </div>
                        </div>
                        <div class="bg-green-900/20 p-2 rounded">
                            <div class="text-xs text-green-400 font-bold mb-1 uppercase tracking-wide text-center">Performance</div>
                            <div class="grid grid-cols-2 gap-1">
                                <button onclick="app.addStat('p1', 'winner')" class="btn-touch bg-green-600 text-white h-10 rounded text-xs font-bold">WINNER</button>
                                <button onclick="app.addStat('p1', 'dink')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">DINK</button>
                                <button onclick="app.addStat('p1', 'recovery')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">RECOV</button>
                                <button onclick="app.addStat('p1', 'outball')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">OUT BALL</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800 rounded-lg p-3 border border-slate-700">
                    <h3 class="text-blue-300 font-bold text-lg mb-2" id="lbl-p2">Player 2</h3>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <div class="bg-red-900/20 p-2 rounded">
                            <div class="text-xs text-red-400 font-bold mb-1 uppercase tracking-wide text-center">Errors</div>
                            <div class="grid grid-cols-3 gap-1">
                                <button onclick="app.addStat('p2', 'err_serve')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">SRV</button>
                                <button onclick="app.addStat('p2', 'err_return')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">RET</button>
                                <button onclick="app.addStat('p2', 'err_net')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">NET</button>
                                <button onclick="app.addStat('p2', 'err_wide')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">WIDE</button>
                                <button onclick="app.addStat('p2', 'err_long')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">LONG</button>
                                <button onclick="app.addStat('p2', 'err_high')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">HIGH</button>
                            </div>
                        </div>
                        <div class="bg-green-900/20 p-2 rounded">
                            <div class="text-xs text-green-400 font-bold mb-1 uppercase tracking-wide text-center">Performance</div>
                            <div class="grid grid-cols-2 gap-1">
                                <button onclick="app.addStat('p2', 'winner')" class="btn-touch bg-green-600 text-white h-10 rounded text-xs font-bold">WINNER</button>
                                <button onclick="app.addStat('p2', 'dink')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">DINK</button>
                                <button onclick="app.addStat('p2', 'recovery')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">RECOV</button>
                                <button onclick="app.addStat('p2', 'outball')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">OUT BALL</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-B" class="p-2 space-y-4 pb-10 hidden">
                 <div class="bg-slate-800 rounded-lg p-3 border border-slate-700">
                    <h3 class="text-orange-300 font-bold text-lg mb-2" id="lbl-p3">Player 3</h3>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <div class="bg-red-900/20 p-2 rounded">
                            <div class="text-xs text-red-400 font-bold mb-1 uppercase tracking-wide text-center">Errors</div>
                            <div class="grid grid-cols-3 gap-1">
                                <button onclick="app.addStat('p3', 'err_serve')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">SRV</button>
                                <button onclick="app.addStat('p3', 'err_return')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">RET</button>
                                <button onclick="app.addStat('p3', 'err_net')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">NET</button>
                                <button onclick="app.addStat('p3', 'err_wide')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">WIDE</button>
                                <button onclick="app.addStat('p3', 'err_long')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">LONG</button>
                                <button onclick="app.addStat('p3', 'err_high')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">HIGH</button>
                            </div>
                        </div>
                        <div class="bg-green-900/20 p-2 rounded">
                            <div class="text-xs text-green-400 font-bold mb-1 uppercase tracking-wide text-center">Performance</div>
                            <div class="grid grid-cols-2 gap-1">
                                <button onclick="app.addStat('p3', 'winner')" class="btn-touch bg-green-600 text-white h-10 rounded text-xs font-bold">WINNER</button>
                                <button onclick="app.addStat('p3', 'dink')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">DINK</button>
                                <button onclick="app.addStat('p3', 'recovery')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">RECOV</button>
                                <button onclick="app.addStat('p3', 'outball')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">OUT BALL</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800 rounded-lg p-3 border border-slate-700">
                    <h3 class="text-orange-300 font-bold text-lg mb-2" id="lbl-p4">Player 4</h3>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <div class="bg-red-900/20 p-2 rounded">
                            <div class="text-xs text-red-400 font-bold mb-1 uppercase tracking-wide text-center">Errors</div>
                            <div class="grid grid-cols-3 gap-1">
                                <button onclick="app.addStat('p4', 'err_serve')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">SRV</button>
                                <button onclick="app.addStat('p4', 'err_return')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">RET</button>
                                <button onclick="app.addStat('p4', 'err_net')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">NET</button>
                                <button onclick="app.addStat('p4', 'err_wide')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">WIDE</button>
                                <button onclick="app.addStat('p4', 'err_long')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">LONG</button>
                                <button onclick="app.addStat('p4', 'err_high')" class="btn-touch bg-red-600 text-white h-10 rounded text-xs font-bold">HIGH</button>
                            </div>
                        </div>
                        <div class="bg-green-900/20 p-2 rounded">
                            <div class="text-xs text-green-400 font-bold mb-1 uppercase tracking-wide text-center">Performance</div>
                            <div class="grid grid-cols-2 gap-1">
                                <button onclick="app.addStat('p4', 'winner')" class="btn-touch bg-green-600 text-white h-10 rounded text-xs font-bold">WINNER</button>
                                <button onclick="app.addStat('p4', 'dink')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">DINK</button>
                                <button onclick="app.addStat('p4', 'recovery')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">RECOV</button>
                                <button onclick="app.addStat('p4', 'outball')" class="btn-touch bg-slate-600 text-white h-10 rounded text-xs font-bold">OUT BALL</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="stats-modal" class="fixed inset-0 bg-slate-900 z-40 hidden flex flex-col p-4 overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">Match Analytics</h2>
            <button onclick="app.closeStats()" class="text-blue-400 font-bold">CLOSE</button>
        </div>
        
        <div class="flex space-x-2 mb-4">
             <button onclick="app.shareStats()" class="bg-green-600 text-white px-4 py-2 rounded flex-1 font-bold shadow">ðŸ“¤ SHARE SUMMARY</button>
        </div>

        <div class="bg-slate-800 p-2 rounded mb-4 shadow">
            <h3 class="text-center text-sm mb-2 text-slate-400">Error Breakdown (Current Game)</h3>
            <div class="h-48 relative w-full">
                <canvas id="errorChart"></canvas>
            </div>
        </div>

        <div class="bg-slate-800 p-4 rounded text-sm space-y-2 mb-6 shadow" id="stats-text-container">
            </div>
    </div>

    <script>
        const app = {
            data: {
                matchId: null,
                date: null,
                players: { p1: '', p2: '', p3: '', p4: '' },
                currentGame: 1,
                stats: { 1: [], 2: [], 3: [] }, // Arrays of actions for Undo capabilities
            },
            
            init: function() {
                this.loadFromStorage();
                
                // If we have an active match, resume it
                if(this.data.matchId) {
                    this.resumeUI();
                } else {
                    document.getElementById('setup-screen').classList.remove('hidden');
                    this.renderHistoryList();
                }
            },

            loadFromStorage: function() {
                const active = localStorage.getItem('pb_active_match');
                if (active) this.data = JSON.parse(active);
            },

            saveToStorage: function() {
                localStorage.setItem('pb_active_match', JSON.stringify(this.data));
                
                // Also update history list
                let history = JSON.parse(localStorage.getItem('pb_match_history') || '[]');
                const idx = history.findIndex(m => m.matchId === this.data.matchId);
                if(idx > -1) history[idx] = this.data;
                else history.unshift(this.data);
                
                localStorage.setItem('pb_match_history', JSON.stringify(history));
            },

            renderHistoryList: function() {
                const history = JSON.parse(localStorage.getItem('pb_match_history') || '[]');
                const container = document.getElementById('history-list-setup');
                container.innerHTML = '';
                
                if(history.length === 0) {
                    container.innerHTML = '<div class="text-xs text-slate-500">No matches found</div>';
                    return;
                }

                history.forEach(match => {
                    const div = document.createElement('div');
                    div.className = "bg-slate-700 p-3 rounded flex justify-between items-center";
                    div.innerHTML = `
                        <div>
                            <div class="text-xs text-slate-400">${new Date(match.date).toLocaleDateString()}</div>
                            <div class="text-sm font-bold text-white">${match.players.p1}/${match.players.p2} vs ${match.players.p3}/${match.players.p4}</div>
                        </div>
                        <button class="bg-blue-600 px-3 py-1 rounded text-xs font-bold" onclick="app.loadMatch('${match.matchId}')">LOAD</button>
                    `;
                    container.appendChild(div);
                });
            },

            loadMatch: function(id) {
                const history = JSON.parse(localStorage.getItem('pb_match_history') || '[]');
                const match = history.find(m => m.matchId === id);
                if(match) {
                    this.data = match;
                    this.saveToStorage(); // Set as active
                    this.resumeUI();
                }
            },

            startMatch: function() {
                const p1 = document.getElementById('p1-name').value || 'P1';
                const p2 = document.getElementById('p2-name').value || 'P2';
                const p3 = document.getElementById('p3-name').value || 'P3';
                const p4 = document.getElementById('p4-name').value || 'P4';

                this.data = {
                    matchId: Date.now().toString(),
                    date: new Date().toISOString(),
                    players: { p1, p2, p3, p4 },
                    currentGame: 1,
                    stats: { 1: [], 2: [], 3: [] }
                };
                
                this.saveToStorage();
                this.resumeUI();
            },

            resumeUI: function() {
                // Hide setup, show main
                document.getElementById('setup-screen').classList.add('hidden');
                document.getElementById('main-interface').classList.remove('hidden');
                
                // Update labels
                document.getElementById('lbl-p1').innerText = this.data.players.p1;
                document.getElementById('lbl-p2').innerText = this.data.players.p2;
                document.getElementById('lbl-p3').innerText = this.data.players.p3;
                document.getElementById('lbl-p4').innerText = this.data.players.p4;

                // Set Game Selector
                document.getElementById('game-selector').value = this.data.currentGame;
                
                this.switchTab('A'); // Default to Team A
            },

            resetMatchConfirm: function() {
                if(confirm("Start a new match? Current data is saved in History.")) {
                    localStorage.removeItem('pb_active_match');
                    location.reload();
                }
            },

            toggleHistory: function() {
                // Simple reload to get back to setup screen where history lives
                if(confirm("Go back to match list?")) location.reload();
            },

            switchTab: function(team) {
                const tabA = document.getElementById('tab-btn-A');
                const tabB = document.getElementById('tab-btn-B');
                const viewA = document.getElementById('view-A');
                const viewB = document.getElementById('view-B');

                if (team === 'A') {
                    tabA.className = "flex-1 py-3 bg-slate-700 border-b-4 border-blue-500 text-blue-100";
                    tabB.className = "flex-1 py-3 bg-slate-800 border-b-4 border-transparent text-slate-500";
                    viewA.classList.remove('hidden');
                    viewB.classList.add('hidden');
                } else {
                    tabB.className = "flex-1 py-3 bg-slate-700 border-b-4 border-orange-500 text-orange-100";
                    tabA.className = "flex-1 py-3 bg-slate-800 border-b-4 border-transparent text-slate-500";
                    viewB.classList.remove('hidden');
                    viewA.classList.add('hidden');
                }
            },

            switchGame: function(gameNum) {
                this.data.currentGame = parseInt(gameNum);
                // Ensure stats array exists
                if(!this.data.stats[this.data.currentGame]) {
                    this.data.stats[this.data.currentGame] = [];
                }
                this.saveToStorage();
            },

            addStat: function(playerKey, type) {
                // Add action to current game log
                if(!this.data.stats[this.data.currentGame]) this.data.stats[this.data.currentGame] = [];
                
                this.data.stats[this.data.currentGame].push({
                    player: playerKey,
                    type: type,
                    timestamp: Date.now()
                });
                
                this.saveToStorage();
                
                // Visual Feedback (Flash screen slightly)
                const view = document.getElementById('input-area');
                view.classList.add('bg-slate-800');
                setTimeout(() => view.classList.remove('bg-slate-800'), 100);
            },

            undoLast: function() {
                const g = this.data.currentGame;
                if (this.data.stats[g] && this.data.stats[g].length > 0) {
                    this.data.stats[g].pop();
                    this.saveToStorage();
                    alert("Undo successful.");
                } else {
                    alert("Nothing to undo in this game.");
                }
            },

            // --- ANALYTICS & SHARING ---

            calculateStats: function(gameId) {
                const logs = this.data.stats[gameId] || [];
                const totals = {
                    teamA: { errors: 0, winners: 0, details: {} },
                    teamB: { errors: 0, winners: 0, details: {} }
                };

                const errorTypes = ['err_serve', 'err_return', 'err_net', 'err_wide', 'err_long', 'err_high'];

                logs.forEach(log => {
                    const isTeamA = (log.player === 'p1' || log.player === 'p2');
                    const target = isTeamA ? totals.teamA : totals.teamB;
                    
                    if (!target.details[log.type]) target.details[log.type] = 0;
                    target.details[log.type]++;

                    if (errorTypes.includes(log.type)) target.errors++;
                    if (log.type === 'winner') target.winners++;
                });

                return totals;
            },

            showStats: function() {
                document.getElementById('stats-modal').classList.remove('hidden');
                this.renderChart();
                this.renderStatsText();
            },

            closeStats: function() {
                document.getElementById('stats-modal').classList.add('hidden');
            },

            renderStatsText: function() {
                const totals = this.calculateStats(this.data.currentGame);
                const container = document.getElementById('stats-text-container');
                
                let html = `
                    <div class="grid grid-cols-2 gap-4 border-b border-slate-600 pb-2 mb-2 text-center">
                        <div>
                            <h4 class="text-blue-400 font-bold">TEAM A</h4>
                            <div class="text-2xl font-bold">${totals.teamA.errors}</div>
                            <div class="text-xs text-slate-400">Total Errors</div>
                        </div>
                        <div>
                            <h4 class="text-orange-400 font-bold">TEAM B</h4>
                            <div class="text-2xl font-bold">${totals.teamB.errors}</div>
                            <div class="text-xs text-slate-400">Total Errors</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <div class="text-xl text-green-400 font-bold">${totals.teamA.winners}</div>
                            <div class="text-xs text-slate-400">Winners</div>
                        </div>
                        <div>
                            <div class="text-xl text-green-400 font-bold">${totals.teamB.winners}</div>
                            <div class="text-xs text-slate-400">Winners</div>
                        </div>
                    </div>
                `;
                container.innerHTML = html;
            },

            renderChart: function() {
                const ctx = document.getElementById('errorChart').getContext('2d');
                const totals = this.calculateStats(this.data.currentGame);
                
                // Categories
                const cats = ['err_serve', 'err_return', 'err_net', 'err_wide', 'err_long', 'err_high'];
                const labels = ['Srv', 'Ret', 'Net', 'Wide', 'Long', 'High'];
                
                const dataA = cats.map(c => totals.teamA.details[c] || 0);
                const dataB = cats.map(c => totals.teamB.details[c] || 0);

                if(window.myChart) window.myChart.destroy();

                window.myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'Team A', data: dataA, backgroundColor: '#60a5fa' },
                            { label: 'Team B', data: dataB, backgroundColor: '#fb923c' }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true, ticks: { color: 'white' } },
                            x: { ticks: { color: 'white' } }
                        },
                        plugins: {
                            legend: { labels: { color: 'white' } }
                        }
                    }
                });
            },

            shareStats: function() {
                const g = this.data.currentGame;
                const t = this.calculateStats(g);
                const p = this.data.players;
                
                let text = `ðŸ¥’ MATCH SUMMARY\n`;
                text += `Date: ${new Date().toLocaleDateString()}\n`;
                text += `Game ${g}\n\n`;
                text += `TEAM A (${p.p1} & ${p.p2})\n`;
                text += `Errors: ${t.teamA.errors} | Winners: ${t.teamA.winners}\n\n`;
                text += `TEAM B (${p.p3} & ${p.p4})\n`;
                text += `Errors: ${t.teamB.errors} | Winners: ${t.teamB.winners}\n\n`;
                text += `Generated by PB Tracker`;

                if (navigator.share) {
                    navigator.share({
                        title: 'Pickleball Match Stats',
                        text: text
                    }).catch(console.error);
                } else {
                    navigator.clipboard.writeText(text);
                    alert("Summary copied to clipboard!");
                }
            }
        };

        // Start App
        window.onload = function() {
            app.init();
        };
    </script>
</body>
</html>